{% extends "base.html" %}

{% block content %}
<div class="quiz-wrapper">
  <!-- Cabeçalho -->
  <div class="quiz-header">
    <h1 class="quiz-title">Quiz!</h1>
    <p class="quiz-progress">Pergunta {{ current }}/{{ total }}</p>
    <p class="quiz-timer">⏳ Tempo restante: <span id="time">02:00</span></p>
  </div>

  <!-- Pergunta -->
  <div class="quiz-question">
    <h2>{{ question.text }}</h2>
  </div>

  <!-- Opções -->
  <div class="quiz-options">
    {% for option_text, option_id in [
        (question.option1, 1),
        (question.option2, 2),
        (question.option3, 3),
        (question.option4, 4)
    ] %}
      <button class="option-btn" onclick="submitAnswer('{{ option_id }}')">
        {{ option_text }}
      </button>
    {% endfor %}
  </div>

  <!-- Feedback -->
  <div id="feedback" class="feedback"></div>
</div>

<script>
let timeLeft = 120; // 2 minutos em segundos
const timerElement = document.getElementById("time");

function updateTimer() {
    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    timerElement.textContent =
        (minutes < 10 ? "0" : "") + minutes + ":" +
        (seconds < 10 ? "0" : "") + seconds;

    if (timeLeft <= 0) {
        window.location.href = "{{ url_for('quiz_result') }}";
    }
    timeLeft--;
}
setInterval(updateTimer, 1000);

function submitAnswer(optionId) {
    fetch('{{ url_for("quiz_answer", question_id=question.id) }}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ selected_option: optionId })
    })
    .then(response => response.json())
    .then(data => {
        if(data.time_over) {
            window.location.href = data.next_question_url;
            return;
        }

        const feedbackDiv = document.getElementById('feedback');

        if(data.correct) {
            feedbackDiv.textContent = '✅ Correto!';
            feedbackDiv.className = 'feedback correct';
        } else {
            feedbackDiv.textContent = '❌ Errado! Resposta certa: ' + data.correct_answer;
            feedbackDiv.className = 'feedback wrong';
        }

        setTimeout(() => {
            window.location.href = data.next_question_url;
        }, 1500);
    })
    .catch(error => console.error('Erro:', error));
}
</script>

<style>
.quiz-wrapper {
  max-width: 600px;
  margin: 50px auto;
  text-align: center;
  background: linear-gradient(145deg, #ffecd2, #fcb69f);
  padding: 30px;
  border-radius: 25px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.quiz-header {
  margin-bottom: 20px;
}

.quiz-title {
  font-size: 36px;
  font-weight: 700;
  color: #ff6b6b;
}

.quiz-progress, .quiz-timer {
  font-size: 16px;
  color: #555;
  margin: 5px 0;
}

.quiz-question h2 {
  font-size: 24px;
  margin: 20px 0;
  color: #222;
}

.quiz-options {
  display: grid;
  gap: 15px;
  margin-top: 20px;
}

.option-btn {
  padding: 15px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 50px;
  border: none;
  background: #4facfe;
  color: white;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}

.option-btn:hover {
  transform: scale(1.05);
  background: #00f2fe;
}

.feedback {
  margin-top: 25px;
  font-size: 20px;
  font-weight: bold;
}

.feedback.correct { color: #27ae60; }
.feedback.wrong { color: #e74c3c; }
</style>
{% endblock %}
