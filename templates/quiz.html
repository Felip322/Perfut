{% extends "base.html" %}

{% block content %}
<div class="quiz-wrapper">
  <!-- Cabeçalho -->
  <div class="quiz-header">
    <h1 class="quiz-title">Quiz!</h1>
    <p class="quiz-progress">Pergunta {{ current }}/{{ total }}</p>
    <p class="quiz-timer">⏱️ <span id="timer-display">02:00</span></p>
  </div>

  <!-- Pergunta -->
  <div class="quiz-question">
    <h2>{{ question.text }}</h2>
  </div>

  <!-- Opções -->
  <div class="quiz-options">
    {% for option_text, option_id in [
        (question.option1, 1),
        (question.option2, 2),
        (question.option3, 3),
        (question.option4, 4)
    ] %}
      <button class="option-btn" onclick="submitAnswer('{{ option_id }}')">
        {{ option_text }}
      </button>
    {% endfor %}
  </div>

  <!-- Feedback -->
  <div id="feedback" class="feedback"></div>
</div>

<!-- Sons -->
<audio id="start-sound" src="{{ url_for('static', filename='sounds/whistle_start.mp3') }}"></audio>
<audio id="end-sound" src="{{ url_for('static', filename='sounds/whistle_end.mp3') }}"></audio>
<audio id="goal-sound" src="{{ url_for('static', filename='sounds/goal.mp3') }}"></audio>
<audio id="error-sound" src="{{ url_for('static', filename='sounds/error.mp3') }}"></audio>

<script>
let timeLeft = 120; // 2 minutos
const timerElement = document.getElementById("timer-display");

// Toca apito de início
document.getElementById('start-sound').play();

function updateTimer() {
    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    timerElement.textContent =
        (minutes < 10 ? "0" : "") + minutes + ":" +
        (seconds < 10 ? "0" : "") + seconds;

    if (timeLeft <= 0) {
        document.getElementById('end-sound').play();
        window.location.href = "{{ url_for('quiz_result') }}";
    }
    timeLeft--;
}
setInterval(updateTimer, 1000);

function submitAnswer(optionId) {
    fetch('{{ url_for("quiz_answer", question_id=question.id) }}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ selected_option: optionId })
    })
    .then(response => response.json())
    .then(data => {
        const feedbackDiv = document.getElementById('feedback');

        if(data.correct) {
            feedbackDiv.textContent = '✅ Correto!';
            feedbackDiv.className = 'feedback correct';
            document.getElementById('goal-sound').play();
        } else {
            feedbackDiv.textContent = '❌ Errado! Resposta certa: ' + data.correct_answer;
            feedbackDiv.className = 'feedback wrong';
            document.getElementById('error-sound').play();
        }

        setTimeout(() => {
            window.location.href = data.next_question_url;
        }, 1500);
    })
    .catch(error => console.error('Erro:', error));
}
</script>

<style>
.quiz-wrapper {
  max-width: 600px;
  margin: 50px auto;
  text-align: center;
  background: var(--card);
  color: var(--text);
  padding: 40px 30px;
  border-radius: 25px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  font-family: 'Arial Black', sans-serif;
}

.quiz-header {
  margin-bottom: 20px;
}

.quiz-title {
  font-size: 36px;
  font-weight: 700;
  color: var(--accent);
}

.quiz-progress {
  font-size: 18px;
  margin-bottom: 5px;
  color: #fff;
  text-shadow: 1px 1px 3px #000;
}

.quiz-timer {
  font-size: 28px;
  font-weight: bold;
  color: #ff3b3b;
  text-shadow: 2px 2px 5px #000;
  background: #000;
  padding: 5px 15px;
  border-radius: 8px;
  display: inline-block;
  letter-spacing: 2px;
}

.quiz-question h2 {
  font-size: 24px;
  margin: 20px 0;
  color: var(--text);
}

.quiz-options {
  display: grid;
  gap: 15px;
  margin-top: 20px;
}

.option-btn {
  padding: 15px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 50px;
  border: none;
  background: var(--accent);
  color: var(--card);
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.option-btn:hover {
  transform: scale(1.05);
  background: #ffc107;
}

.feedback {
  margin-top: 25px;
  font-size: 22px;
  font-weight: bold;
}

.feedback.correct { color: #27ae60; }
.feedback.wrong { color: #e74c3c; }
</style>
{% endblock %}
